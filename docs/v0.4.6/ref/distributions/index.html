<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Probability Distributions · Gen</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Gen</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../../tutorials/">Tutorials</a></li><li><span class="tocitem">Modeling Languages and APIs</span><ul><li><a class="tocitem" href="../gfi/">Generative Functions</a></li><li class="is-active"><a class="tocitem" href>Probability Distributions</a><ul class="internal"><li><a class="tocitem" href="#Built-In-Distributions"><span>Built-In Distributions</span></a></li><li><a class="tocitem" href="#dist_dsl"><span>Defining New Distributions Inline with the <code>@dist</code> DSL</span></a></li><li><a class="tocitem" href="#Mixture-Distribution-Constructors"><span>Mixture Distribution Constructors</span></a></li><li><a class="tocitem" href="#Defining-New-Distributions-From-Scratch"><span>Defining New Distributions From Scratch</span></a></li></ul></li><li><a class="tocitem" href="../modeling/">Built-in Modeling Language</a></li><li><a class="tocitem" href="../combinators/">Generative Function Combinators</a></li><li><a class="tocitem" href="../choice_maps/">Choice Maps</a></li><li><a class="tocitem" href="../selections/">Selections</a></li><li><a class="tocitem" href="../parameter_optimization/">Optimizing Trainable Parameters</a></li><li><a class="tocitem" href="../trace_translators/">Trace Translators</a></li><li><a class="tocitem" href="../extending/">Extending Gen</a></li></ul></li><li><span class="tocitem">Standard Inference Library</span><ul><li><a class="tocitem" href="../importance/">Importance Sampling</a></li><li><a class="tocitem" href="../map/">MAP Optimization</a></li><li><a class="tocitem" href="../mcmc/">Markov chain Monte Carlo</a></li><li><a class="tocitem" href="../map/">MAP Optimization</a></li><li><a class="tocitem" href="../pf/">Particle Filtering</a></li><li><a class="tocitem" href="../vi/">Variational Inference</a></li><li><a class="tocitem" href="../learning/">Learning Generative Functions</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../internals/parameter_optimization/">Optimizing Trainable Parameters</a></li><li><a class="tocitem" href="../internals/language_implementation/">Modeling Language Implementation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Modeling Languages and APIs</a></li><li class="is-active"><a href>Probability Distributions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Probability Distributions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/probcomp/Gen.jl/blob/master/docs/src/ref/distributions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Probability-Distributions"><a class="docs-heading-anchor" href="#Probability-Distributions">Probability Distributions</a><a id="Probability-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Probability-Distributions" title="Permalink"></a></h1><p>Gen provides a library of built-in probability distributions, and three ways of defining custom distributions, each of which are explained below:</p><ol><li><p>The <a href="#dist_dsl"><code>@dist</code> constructor</a>, for a distribution that can be expressed as a simple deterministic transformation (technically, a <a href="https://en.wikipedia.org/wiki/Pushforward_measure">pushforward</a>) of an existing distribution.</p></li><li><p>The <a href="#Gen.HeterogeneousMixture"><code>HeterogeneousMixture</code></a> and <a href="#Gen.HomogeneousMixture"><code>HomogeneousMixture</code></a> constructors for distributions that are mixtures of other distributions.</p></li><li><p>An API for defining arbitrary <a href="../extending/#custom_distributions">custom distributions</a> in plain Julia code.</p></li></ol><h2 id="Built-In-Distributions"><a class="docs-heading-anchor" href="#Built-In-Distributions">Built-In Distributions</a><a id="Built-In-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Built-In-Distributions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="Gen.bernoulli" href="#Gen.bernoulli"><code>Gen.bernoulli</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">bernoulli(prob_true::Real)</code></pre><p>Samples a <code>Bool</code> value which is true with given probability</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/bernoulli.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.beta" href="#Gen.beta"><code>Gen.beta</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">beta(alpha::Real, beta::Real)</code></pre><p>Sample a <code>Float64</code> from a beta distribution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/beta.jl#L6-L10">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.beta_uniform" href="#Gen.beta_uniform"><code>Gen.beta_uniform</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">beta_uniform(theta::Real, alpha::Real, beta::Real)</code></pre><p>Samples a <code>Float64</code> value from a mixture of a uniform distribution on [0, 1] with probability <code>1-theta</code> and a beta distribution with parameters <code>alpha</code> and <code>beta</code> with probability <code>theta</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/beta_uniform.jl#L5-L9">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.binom" href="#Gen.binom"><code>Gen.binom</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">binom(n::Integer, p::Real)</code></pre><p>Sample an <code>Int</code> from the Binomial distribution with parameters <code>n</code> (number of trials) and <code>p</code> (probability of success in each trial).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/binom.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.categorical" href="#Gen.categorical"><code>Gen.categorical</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">categorical(probs::AbstractArray{U, 1}) where {U &lt;: Real}</code></pre><p>Given a vector of probabilities <code>probs</code> where <code>sum(probs) = 1</code>, sample an <code>Int</code> <code>i</code> from the set {1, 2, .., <code>length(probs)</code>} with probability <code>probs[i]</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/categorical.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.cauchy" href="#Gen.cauchy"><code>Gen.cauchy</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">cauchy(x0::Real, gamma::Real)</code></pre><p>Sample a <code>Float64</code> value from a Cauchy distribution with location x0 and scale gamma.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/cauchy.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.exponential" href="#Gen.exponential"><code>Gen.exponential</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">exponential(rate::Real)</code></pre><p>Sample a <code>Float64</code> from the exponential distribution with rate parameter <code>rate</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/exponential.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.gamma" href="#Gen.gamma"><code>Gen.gamma</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">gamma(shape::Real, scale::Real)</code></pre><p>Sample a <code>Float64</code> from a gamma distribution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/gamma.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.geometric" href="#Gen.geometric"><code>Gen.geometric</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">geometric(p::Real)</code></pre><p>Sample an <code>Int</code> from the Geometric distribution with parameter <code>p</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/geometric.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.inv_gamma" href="#Gen.inv_gamma"><code>Gen.inv_gamma</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">inv_gamma(shape::Real, scale::Real)</code></pre><p>Sample a <code>Float64</code> from a inverse gamma distribution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/inv_gamma.jl#L5-L9">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.laplace" href="#Gen.laplace"><code>Gen.laplace</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">laplace(loc::Real, scale::Real)</code></pre><p>Sample a <code>Float64</code> from a laplace distribution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/laplace.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.mvnormal" href="#Gen.mvnormal"><code>Gen.mvnormal</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">mvnormal(mu::AbstractVector{T}, cov::AbstractMatrix{U}} where {T&lt;:Real,U&lt;:Real}</code></pre><p>Samples a <code>Vector{Float64}</code> value from a multivariate normal distribution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/mvnormal.jl#L5-L9">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.neg_binom" href="#Gen.neg_binom"><code>Gen.neg_binom</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">neg_binom(r::Real, p::Real)</code></pre><p>Sample an <code>Int</code> from a Negative Binomial distribution. Returns the number of failures before the <code>r</code>th success in a sequence of independent Bernoulli trials. <code>r</code> is the number of successes (which may be fractional) and <code>p</code> is the probability of success per trial.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/neg_binom.jl#L3-L9">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.normal" href="#Gen.normal"><code>Gen.normal</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">normal(mu::Real, std::Real)</code></pre><p>Samples a <code>Float64</code> value from a normal distribution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/normal.jl#L22-L26">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.piecewise_uniform" href="#Gen.piecewise_uniform"><code>Gen.piecewise_uniform</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">piecewise_uniform(bounds, probs)</code></pre><p>Samples a <code>Float64</code> value from a piecewise uniform continuous distribution.</p><p>There are <code>n</code> bins where <code>n = length(probs)</code> and <code>n + 1 = length(bounds)</code>. Bounds must satisfy <code>bounds[i] &lt; bounds[i+1]</code> for all <code>i</code>. The probability density at <code>x</code> is zero if <code>x &lt;= bounds[1]</code> or <code>x &gt;= bounds[end]</code> and is otherwise <code>probs[bin] / (bounds[bin] - bounds[bin+1])</code> where <code>bounds[bin] &lt; x &lt;= bounds[bin+1]</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/piecewise_uniform.jl#L3-L11">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.poisson" href="#Gen.poisson"><code>Gen.poisson</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">poisson(lambda::Real)</code></pre><p>Sample an <code>Int</code> from the Poisson distribution with rate <code>lambda</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/poisson.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.uniform" href="#Gen.uniform"><code>Gen.uniform</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">uniform(low::Real, high::Real)</code></pre><p>Sample a <code>Float64</code> from the uniform distribution on the interval [low, high].</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/uniform_continuous.jl#L5-L9">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.uniform_discrete" href="#Gen.uniform_discrete"><code>Gen.uniform_discrete</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">uniform_discrete(low::Integer, high::Integer)</code></pre><p>Sample an <code>Int</code> from the uniform distribution on the set {low, low + 1, ..., high-1, high}.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/distributions/uniform_discrete.jl#L3-L7">source</a></section></article><h2 id="dist_dsl"><a class="docs-heading-anchor" href="#dist_dsl">Defining New Distributions Inline with the <code>@dist</code> DSL</a><a id="dist_dsl-1"></a><a class="docs-heading-anchor-permalink" href="#dist_dsl" title="Permalink"></a></h2><p>The <code>@dist</code> DSL allows the user to concisely define a distribution, as long as that distribution can be expressed as a certain type of deterministic transformation of an existing distribution.  The syntax of the <code>@dist</code> DSL, as well as the class of permitted deterministic transformations, are explained below.</p><pre><code class="language-julia hljs">@dist name(arg1, arg2, ..., argN) = body</code></pre><p>or</p><pre><code class="language-julia hljs">@dist function name(arg1, arg2, ..., argN)
    body
end</code></pre><p>Here <code>body</code> is ordinary Julia code, with the constraint that <code>body</code> must contain exactly one random choice.  The value of the <code>@dist</code> expression is then a <code>Gen.Distribution</code> object called <code>name</code>, parameterized by <code>arg1, ..., argN</code>, representing the distribution over <em>return values</em> of <code>body</code>.</p><p>This DSL is designed to address the issue that sometimes, values stored in the trace do not correspond to the most natural physical elements of the model state space, making inference programming and querying more taxing than necessary. For example, suppose we have a model of classes at a school, where the number of students is random, with mean 10, but always at least 3. Rather than writing the model as</p><pre><code class="language-julia hljs">@gen function class_model()
   n_students = @trace(poisson(7), :n_students_minus_3) + 3
   ...
end</code></pre><p>and thinking about the random variable <code>:n_students_minus_3</code>, you can use the <code>@dist</code> DSL to instead write</p><pre><code class="language-julia hljs">@dist student_distr(mean, min) = poisson(mean-min) + min

@gen function class_model()
   n_students = @trace(student_distr(10, 3), :n_students)
   ...
end</code></pre><p>and think about the more natural random variable <code>:n_students</code>.  This leads to more natural inference programs, which can constrain and propose directly to the <code>:n_students</code> trace address.</p><h3 id="Permitted-constructs-for-the-body-of-a-@dist"><a class="docs-heading-anchor" href="#Permitted-constructs-for-the-body-of-a-@dist">Permitted constructs for the body of a <code>@dist</code></a><a id="Permitted-constructs-for-the-body-of-a-@dist-1"></a><a class="docs-heading-anchor-permalink" href="#Permitted-constructs-for-the-body-of-a-@dist" title="Permalink"></a></h3><p>It is not possible for <code>@dist</code> to work on any arbitrary <code>body</code>.  We now describe which constructs are permitted inside the <code>body</code> of a <code>@dist</code> expression.</p><p>We can think of the <code>body</code> of an <code>@dist</code> function as containing ordinary Julia code, except that in addition to being described by their ordinary Julia types, each expression also belongs to one of three &quot;type spaces.&quot; These are:</p><ol><li><code>CONST</code>: Constants, whose value is known at the time this <code>@dist</code> expression is evaluated.</li><li><code>ARG</code>: Arguments and (deterministic, differentiable) functions of arguments. All expressions representing non-random values that depend on distribution arguments are <code>ARG</code> expressions.</li><li><code>RND</code>: Random variables. All expressions whose runtime values may differ across multiple calls to this distribution (with the same arguments) are <code>RND</code> expressions.</li></ol><p><strong>Importantly, Julia control flow constructs generally expect <code>CONST</code> values: the condition of an <code>if</code> or the range of a <code>for</code> loop cannot be <code>ARG</code> or <code>RND</code>.</strong></p><p>The body expression as a whole must be a <code>RND</code> expression, representing a random variable. The behavior of the <code>@dist</code> definition is then to define a new distribution (with name <code>name</code>) that samples and evaluates the logpdf of the random variable represented by the <code>body</code> expression.</p><p>Expressions are typed compositionally, with the following typing rules:</p><ol><li><p><strong>Literals and free variables are <code>CONST</code>s.</strong> Literals and symbols that appear free in the <code>@dist</code> body are of type <code>CONST</code>.</p></li><li><p><strong>Arguments are <code>ARG</code>s.</strong> Symbols bound as arguments in the <code>@dist</code> declaration have type <code>ARG</code> in its body.</p></li><li><p><strong>Drawing from a distribution gives <code>RND</code>.</strong> If <code>d</code> is a distribution, and <code>x_i</code> are of type <code>ARG</code> or <code>CONST</code>, <code>d(x_1, x_2, ...)</code> is of type <code>RND</code>.</p></li><li><p><strong>Functions of <code>CONST</code>s are <code>CONST</code>s.</strong> If <code>f</code> is a deterministic function and <code>x_i</code> are all of type <code>CONST</code>, <code>f(x_1, x_2, ...)</code> is of type <code>CONST</code>.</p></li><li><p><strong>Functions of <code>CONST</code>s and <code>ARG</code>s are <code>ARG</code>s.</strong> If <code>f</code> is a <em>differentiable</em> function, and each <code>x_i</code> is either a <code>CONST</code> or a <em>scalar</em> <code>ARG</code> (with at least one <code>x_i</code> being an <code>ARG</code>), then <code>f(x_1, x_2, ...)</code> is of type <code>ARG</code>.</p></li><li><p><strong>Functions of <code>CONST</code>s, <code>ARG</code>s, and <code>RND</code>s are <code>RND</code>s.</strong> If <code>f</code> is one of a special set of deterministic functions we&#39;ve defined (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>exp</code>, <code>log</code>, <code>getindex</code>), and exactly one of its arguments <code>x_i</code> is of type <code>RND</code>, then <code>f(x_1, x_2, ...)</code> is of type <code>RND</code>.</p></li></ol><p>One way to think about this, without all the rules, is that <code>CONST</code> values are &quot;contaminated&quot; by interaction with <code>ARG</code> values (becoming <code>ARG</code>s themselves), and both <code>CONST</code> and <code>ARG</code> are &quot;contaminated&quot; by interaction with <code>RND</code>. Thinking of the body as an AST, the journey from leaf node to root node always involves transitions in the direction of <code>CONST -&gt; ARG -&gt; RND</code>, never in reverse.</p><h4 id="Restrictions"><a class="docs-heading-anchor" href="#Restrictions">Restrictions</a><a id="Restrictions-1"></a><a class="docs-heading-anchor-permalink" href="#Restrictions" title="Permalink"></a></h4><p>Users may <em>not</em> reassign to arguments (like <code>x</code> in the above example), and may not apply functions with side effects. Names bound to expressions of type <code>RND</code> must be used only once. e.g., <code>let x = normal(0, 1) in x + x</code> is not allowed.</p><h4 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h4><p>Let&#39;s walk through some examples.</p><pre><code class="language-julia hljs">@dist f(x) = exp(normal(x, 1))</code></pre><p>We can annotate with types:</p><pre><code class="nohighlight hljs">1 :: CONST		  (by rule 1)
x :: ARG 		  (by rule 2)
normal(x, 1) :: RND 	  (by rule 3)
exp(normal(x, 1)) :: RND  (by rule 6)</code></pre><p>Here&#39;s another:</p><pre><code class="language-julia hljs">@dist function labeled_cat(labels, probs)
	index = categorical(probs)
	labels[index]
end</code></pre><p>And the types:</p><pre><code class="nohighlight hljs">probs :: ARG 			(by rule 2)
categorical(probs) :: RND 	(by rule 3)
index :: RND 			(Julia assignment)
labels :: ARG 			(by rule 2)
labels[index] :: RND 		(by rule 6, f == getindex)</code></pre><p>Note that <code>getindex</code> is designed to work on anything indexible, not just vectors. So, for example, it also works with Dicts.</p><p>Another one (not as realistic, but it uses all the rules):</p><pre><code class="language-julia hljs">@dist function weird(x)
  log(normal(exp(x), exp(x))) + (x * (2 + 3))
end</code></pre><p>And the types:</p><pre><code class="nohighlight hljs">2, 3 :: CONST 						(by rule 1)
2 + 3 :: CONST 						(by rule 4)
x :: ARG 						(by rule 2)
x * (2 + 3) :: ARG 					(by rule 5)
exp(x) :: ARG 						(by rule 5)
normal(exp(x), exp(x)) :: RND 				(by rule 3)
log(normal(exp(x), exp(x))) :: RND 			(by rule 6)
log(normal(exp(x), exp(x))) + (x * (2 + 3)) :: RND 	(by rule 6)</code></pre><h2 id="Mixture-Distribution-Constructors"><a class="docs-heading-anchor" href="#Mixture-Distribution-Constructors">Mixture Distribution Constructors</a><a id="Mixture-Distribution-Constructors-1"></a><a class="docs-heading-anchor-permalink" href="#Mixture-Distribution-Constructors" title="Permalink"></a></h2><p>There are two built-in constructors for defining mixture distributions:</p><article class="docstring"><header><a class="docstring-binding" id="Gen.HomogeneousMixture" href="#Gen.HomogeneousMixture"><code>Gen.HomogeneousMixture</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">HomogeneousMixture(distribution::Distribution, dims::Vector{Int})</code></pre><p>Define a new distribution that is a mixture of some number of instances of single base distributions.</p><p>The first argument defines the base distribution of each component in the mixture.</p><p>The second argument must have length equal to the number of arguments taken by the base distribution.  A value of 0 at a position in the vector an indicates that the corresponding argument to the base distribution is a scalar, and integer values of i for i &gt;= 1 indicate that the corresponding argument is an i-dimensional array.</p><p>Example:</p><pre><code class="language-julia hljs">mixture_of_normals = HomogeneousMixture(normal, [0, 0])</code></pre><p>The resulting distribution (e.g. <code>mixture_of_normals</code> above) can then be used like the built-in distribution values like <code>normal</code>. The distribution takes <code>n+1</code> arguments where <code>n</code> is the number of arguments taken by the base distribution. The first argument to the distribution is a vector of non-negative mixture weights, which must sum to 1.0. The remaining arguments to the distribution correspond to the arguments of the base distribution, but have a different type: If an argument to the base distribution is a scalar of type <code>T</code>, then the corresponding argument to the mixture distribution is a <code>Vector{T}</code>, where each element of this vector is the argument to the corresponding mixture component. If an argument to the base distribution is an <code>Array{T,N}</code> for some <code>N</code>, then the corresponding argument to the mixture distribution is of the form <code>arr::Array{T,N+1}</code>, where each slice of the array of the form <code>arr[:,:,...,i]</code> is the argument for the <code>i</code>th mixture component.</p><p>Example:</p><pre><code class="language-julia hljs">mixture_of_normals = HomogeneousMixture(normal, [0, 0])
mixture_of_mvnormals = HomogeneousMixture(mvnormal, [1, 2])

@gen function foo()
    # mixture of two normal distributions
    # with means -1.0 and 1.0
    # and standard deviations 0.1 and 10.0
    # the first normal distribution has weight 0.4; the second has weight 0.6
    x ~ mixture_of_normals([0.4, 0.6], [-1.0, 1.0], [0.1, 10.0])

    # mixture of two multivariate normal distributions
    # with means: [0.0, 0.0] and [1.0, 1.0]
    # and covariance matrices: [1.0 0.0; 0.0 1.0] and [10.0 0.0; 0.0 10.0]
    # the first multivariate normal distribution has weight 0.4;
    # the second has weight 0.6
    means = [0.0 1.0; 0.0 1.0] # or, cat([0.0, 0.0], [1.0, 1.0], dims=2)
    covs = cat([1.0 0.0; 0.0 1.0], [10.0 0.0; 0.0 10.0], dims=3)
    y ~ mixture_of_mvnormals([0.4, 0.6], means, covs)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/mixture.jl#L5-L54">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Gen.HeterogeneousMixture" href="#Gen.HeterogeneousMixture"><code>Gen.HeterogeneousMixture</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">HeterogeneousMixture(distributions::Vector{Distribution{T}}) where {T}</code></pre><p>Define a new distribution that is a mixture of a given list of base distributions.</p><p>The argument is the vector of base distributions, one for each mixture component.</p><p>Note that the base distributions must have the same output type.</p><p>Example:</p><pre><code class="language-julia hljs">uniform_beta_mixture = HeterogeneousMixture([uniform, beta])</code></pre><p>The resulting mixture distribution takes <code>n+1</code> arguments, where <code>n</code> is the sum of the number of arguments taken by each distribution in the list. The first argument to the mixture distribution is a vector of non-negative mixture weights, which must sum to 1.0. The remaining arguments are the arguments to each mixture component distribution, in order in which the distributions are passed into the constructor.</p><p>Example:</p><pre><code class="language-julia hljs">@gen function foo()
    # mixure of a uniform distribution on the interval [`lower`, `upper`]
    # and a beta distribution with alpha parameter `a` and beta parameter `b`
    # the uniform as weight 0.4 and the beta has weight 0.6
    x ~ uniform_beta_mixture([0.4, 0.6], lower, upper, a, b)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/probcomp/Gen.jl/blob/7955b07e6df273633da6e72d434884b73fbdffe6/src/modeling_library/mixture.jl#L135-L162">source</a></section></article><h2 id="Defining-New-Distributions-From-Scratch"><a class="docs-heading-anchor" href="#Defining-New-Distributions-From-Scratch">Defining New Distributions From Scratch</a><a id="Defining-New-Distributions-From-Scratch-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-New-Distributions-From-Scratch" title="Permalink"></a></h2><p>For distributions that cannot be expressed in the <code>@dist</code> DSL, users can define a custom distribution by defining an (ordinary Julia) subtype of <code>Gen.Distribution</code> and implementing the methods of the <a href="../extending/#custom_distributions">Distribution API</a>.  This method requires more custom code than using the <code>@dist</code> DSL, but also affords more flexibility: arbitrary user-defined logic for sampling, PDF evaluation, etc.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gfi/">« Generative Functions</a><a class="docs-footer-nextpage" href="../modeling/">Built-in Modeling Language »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 20 September 2023 20:26">Wednesday 20 September 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
