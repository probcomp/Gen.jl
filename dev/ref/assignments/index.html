<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Assignments · Gen</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Gen</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../getting_started/">Getting Started</a></li><li><a class="toctext" href="../../tutorials/">Tutorials</a></li><li><span class="toctext">Language and API Reference</span><ul><li><a class="toctext" href="../gfi/">Generative Functions</a></li><li><a class="toctext" href="../distributions/">Probability Distributions</a></li><li><a class="toctext" href="../modeling/">Built-in Modeling Language</a></li><li><a class="toctext" href="../combinators/">Generative Function Combinators</a></li><li class="current"><a class="toctext" href>Assignments</a><ul class="internal"><li><a class="toctext" href="#Dynamic-Assignment-1">Dynamic Assignment</a></li></ul></li><li><a class="toctext" href="../selections/">Selections</a></li><li><a class="toctext" href="../parameter_optimization/">Optimizing Trainable Parameters</a></li><li><a class="toctext" href="../inference/">Inference Library</a></li></ul></li><li><span class="toctext">Internals</span><ul><li><a class="toctext" href="../internals/parameter_optimization/">Optimizing Trainable Parameters</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Language and API Reference</li><li><a href>Assignments</a></li></ul><a class="edit-page" href="https://github.com/probcomp/Gen/blob/master/docs/src/ref/assignments.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Assignments</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Assignments-1" href="#Assignments-1">Assignments</a></h1><p>Maps from the addresses of random choices to their values are stored in associative tree-structured data structures that have the following abstract type:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.Assignment" href="#Gen.Assignment"><code>Gen.Assignment</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">abstract type Assignment end</code></pre><p>Abstract type for maps from hierarchical addresses to values.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L56-L60">source</a></section><p>Assignments are constructed by users to express observations and/or constraints on the traces of generative functions. Assignments are also returned by certain Gen inference methods, and are used internally by various Gen inference methods.</p><p>Assignments provide the following methods:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.has_value" href="#Gen.has_value"><code>Gen.has_value</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">has_value(assmt::Assignment, addr)</code></pre><p>Return true if there is a value at the given address.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L41-L45">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.get_value" href="#Gen.get_value"><code>Gen.get_value</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">value = get_value(assmt::Assignment, addr)</code></pre><p>Return the value at the given address in the assignment, or throw a KeyError if no value exists. A syntactic sugar is <code>Base.getindex</code>:</p><pre><code class="language-none">value = assmt[addr]</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L23-L30">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.get_subassmt" href="#Gen.get_subassmt"><code>Gen.get_subassmt</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">subassmt = get_subassmt(assmt::Assignment, addr)</code></pre><p>Return the sub-assignment containing all choices whose address is prefixed by addr.</p><p>It is an error if the assignment contains a value at the given address. If there are no choices whose address is prefixed by addr then return an <code>EmptyAssignment</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L12-L20">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.get_values_shallow" href="#Gen.get_values_shallow"><code>Gen.get_values_shallow</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">key_subassmt_iterable = get_values_shallow(assmt::Assignment)</code></pre><p>Return an iterable collection of tuples <code>(key, value)</code> for each top-level key associated with a value.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L48-L53">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.get_subassmts_shallow" href="#Gen.get_subassmts_shallow"><code>Gen.get_subassmts_shallow</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">key_subassmt_iterable = get_subassmts_shallow(assmt::Assignment)</code></pre><p>Return an iterable collection of tuples <code>(key, subassmt::Assignment)</code> for each top-level key that has a non-empty sub-assignment.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L33-L38">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.to_array" href="#Gen.to_array"><code>Gen.to_array</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">arr::Vector{T} = to_array(assmt::Assignment, ::Type{T}) where {T}</code></pre><p>Populate an array with values of choices in the given assignment.</p><p>It is an error if each of the values cannot be coerced into a value of the given type.</p><p><strong>Implementation</strong></p><p>To support <code>to_array</code>, a concrete subtype <code>T &lt;: Assignment</code> should implement the following method:</p><pre><code class="language-none">n::Int = _fill_array!(assmt::T, arr::Vector{V}, start_idx::Int) where {V}</code></pre><p>Populate <code>arr</code> with values from the given assignment, starting at <code>start_idx</code>, and return the number of elements in <code>arr</code> that were populated.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L143-L160">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.from_array" href="#Gen.from_array"><code>Gen.from_array</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">assmt::Assignment = from_array(proto_assmt::Assignment, arr::Vector)</code></pre><p>Return an assignment with the same address structure as a prototype assignment, but with values read off from the given array.</p><p>The order in which addresses are populated is determined by the prototype assignment. It is an error if the number of choices in the prototype assignment is not equal to the length the array.</p><p><strong>Implementation</strong></p><p>To support <code>from_array</code>, a concrete subtype <code>T &lt;: Assignment</code> should implement the following method:</p><pre><code class="language-none">(n::Int, assmt::T) = _from_array(proto_assmt::T, arr::Vector{V}, start_idx::Int) where {V}</code></pre><p>Return an assignment with the same address structure as a prototype assignment, but with values read off from <code>arr</code>, starting at position <code>start_idx</code>, and the number of elements read from <code>arr</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L169-L190">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.address_set" href="#Gen.address_set"><code>Gen.address_set</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">addrs::AddressSet = address_set(assmt::Assignment)</code></pre><p>Return an <code>AddressSet</code> containing the addresses of values in the given assignment.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L240-L244">source</a></section><p>Note that none of these methods mutate the assignment.</p><p>Assignments also provide <code>Base.isempty</code>, which tests of there are no random choices in the assignment, and <code>Base.merge</code>, which takes two assignments, and returns a new assignment containing all random choices in either assignment. It is an error if the assignments both have values at the same address, or if one assignment has a value at an address that is the prefix of the address of a value in the other assignment.</p><h2><a class="nav-anchor" id="Dynamic-Assignment-1" href="#Dynamic-Assignment-1">Dynamic Assignment</a></h2><p>One concrete assignment type is <code>DynamicAssignment</code>, which is mutable. Users construct <code>DynamicAssignments</code> and populate them for use as observations or constraints, e.g.:</p><pre><code class="language-julia">assmt = DynamicAssignment()
assmt[:x] = true
assmt[&quot;foo&quot;] = 1.25
assmt[:y =&gt; 1 =&gt; :z] = -6.3</code></pre><p>There is also a constructor for <code>DynamicAssignment</code> that takes initial (address, value) pairs:</p><pre><code class="language-julia">assmt = DynamicAssignment((:x, true), (&quot;foo&quot;, 1.25), (:y =&gt; 1 =&gt; :z, -6.3))</code></pre><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.DynamicAssignment" href="#Gen.DynamicAssignment"><code>Gen.DynamicAssignment</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">struct DynamicAssignment &lt;: Assignment .. end</code></pre><p>A mutable map from arbitrary hierarchical addresses to values.</p><pre><code class="language-none">assmt = DynamicAssignment()</code></pre><p>Construct an empty map.</p><pre><code class="language-none">assmt = DynamicAssignment(tuples...)</code></pre><p>Construct a map containing each of the given (addr, value) tuples.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L528-L540">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.set_value!" href="#Gen.set_value!"><code>Gen.set_value!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">set_value!(assmt::DynamicAssignment, addr, value)</code></pre><p>Set the given value for the given address.</p><p>Will cause any previous value or sub-assignment at this address to be deleted. It is an error if there is already a value present at some prefix of the given address.</p><p>The following syntactic sugar is provided:</p><pre><code class="language-none">assmt[addr] = value</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L585-L596">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Gen.set_subassmt!" href="#Gen.set_subassmt!"><code>Gen.set_subassmt!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">set_subassmt!(assmt::DynamicAssignment, addr, subassmt::Assignment)</code></pre><p>Replace the sub-assignment rooted at the given address with the given sub-assignment. Set the given value for the given address.</p><p>Will cause any previous value or sub-assignment at the given address to be deleted. It is an error if there is already a value present at some prefix of address.</p></div></div><a class="source-link" target="_blank" href="https://github.com/probcomp/Gen/blob/59f8e12679b771b58e4c8dc5dd022b3b6d2c9d31/src/assignment.jl#L619-L627">source</a></section><footer><hr/><a class="previous" href="../combinators/"><span class="direction">Previous</span><span class="title">Generative Function Combinators</span></a><a class="next" href="../selections/"><span class="direction">Next</span><span class="title">Selections</span></a></footer></article></body></html>
